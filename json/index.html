
<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>json &#8212; Documentation Bibliothèques Python 1.0.0</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/translations.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Python Imaging Library (PIL)" href="../pillow/index.html" />
    <link rel="prev" title="csv" href="../csv/index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="json">
<span id="json-tutorial"></span><h1><code class="docutils literal notranslate"><span class="pre">json</span></code><a class="headerlink" href="#json" title="Lien permanent vers ce titre">¶</a></h1>
<img alt="JSON logo" class="align-right" src="../_images/json.png" />
<p>Par Yoan Blanc <a class="footnote-reference brackets" href="#yb" id="id1">1</a></p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="http://json.org/">JSON</a> (<em>JavaScript Object Notation</em>) est un format simple, compact qui a, au
fil des ans, remplacé <a class="reference external" href="https://www.w3.org/XML/">XML</a> comme format d’échange préféré. Standardisé au sein
de l’Ecma <a class="bibtex reference internal" href="#bray2014javascript" id="id2">[Bra14]</a>, il est devenu incontournable dans les
systèmes actuels.</p>
<p><a class="reference external" href="http://json.org/">JSON</a> comporte six types : chaîne de caractères, nombre, objet, tableau,
booléen (<code class="docutils literal notranslate"><span class="pre">true</span></code>, <code class="docutils literal notranslate"><span class="pre">false</span></code>) et <code class="docutils literal notranslate"><span class="pre">null</span></code>.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;clé&quot;</span><span class="p">:</span> <span class="s2">&quot;valeur&quot;</span><span class="p">,</span>
    <span class="nt">&quot;age&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
    <span class="nt">&quot;pi&quot;</span><span class="p">:</span> <span class="mf">314.59e-2</span><span class="p">,</span>
    <span class="nt">&quot;tableau&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]],</span>
    <span class="nt">&quot;objet&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;clé&quot;</span><span class="p">:</span> <span class="s2">&quot;autre valeur&quot;</span><span class="p">,</span>
        <span class="nt">&quot;booléen&quot;</span><span class="p">:</span> <span class="kc">false</span>
    <span class="p">},</span>
    <span class="nt">&quot;rien&quot;</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Il serait possible de lire directement cette structure de donnée en Python si
les valeurs booléennes et la valeur vide n’étaient pas écrites différemment :
<code class="docutils literal notranslate"><span class="pre">True</span></code>, <code class="docutils literal notranslate"><span class="pre">False</span></code> et <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ast</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="s1">&#39;{&quot;clé&quot;:&quot;valeur&quot;,&quot;age&quot;:20, &#39;</span>
<span class="gp">... </span>                 <span class="s1">&#39;&quot;tableau&quot;: [1, 2, 3, [&quot;x&quot;, &quot;y&quot;]]}&#39;</span><span class="p">)</span>
<span class="go">{&#39;clé&#39;: &#39;valeur&#39;, &#39;age&#39;: 20, &#39;tableau&#39;: [1, 2, 3, [&#39;x&#39;, &#39;y&#39;]]}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">ast</span><span class="o">.</span><span class="n">literal_eval</span><span class="p">(</span><span class="s1">&#39;{&quot;erreur&quot;: null}&#39;</span><span class="p">)</span>
<span class="go">ValueError: malformed node or string: ...</span>
</pre></div>
</div>
</div>
<div class="section" id="exemple">
<h2>Exemple<a class="headerlink" href="#exemple" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le module <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> est des plus simples à utiliser. Il est présenté par
le fameux Kenneith Reitz <a class="bibtex reference internal" href="#schlusser2016" id="id3">[Sch16]</a> dans <a class="reference external" href="http://docs.python-guide.org/en/latest/scenarios/json/">Hitchhiker’s Guide To Python</a>.</p>
<p>L’API du module <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> est similaire à celle utilisée par
<a class="reference external" href="https://docs.python.org/3/library/marshal.html#module-marshal" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">marshal</span></code></a> et <a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> qui permettent de sérialiser des objets
Python.</p>
<dl class="simple">
<dt><a class="reference external" href="https://docs.python.org/3/library/json.html#json.load" title="(disponible dans Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">load()</span></code></a>:</dt><dd><p>charge un fichier JSON;</p>
</dd>
<dt><a class="reference external" href="https://docs.python.org/3/library/json.html#json.loads" title="(disponible dans Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">loads()</span></code></a>:</dt><dd><p>charge une chaîne de caractères;</p>
</dd>
<dt><a class="reference external" href="https://docs.python.org/3/library/json.html#json.dump" title="(disponible dans Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">dump()</span></code></a>:</dt><dd><p>écrit en JSON dans fichier;</p>
</dd>
<dt><a class="reference external" href="https://docs.python.org/3/library/json.html#json.dumps" title="(disponible dans Python v3.9)"><code class="xref py py-func docutils literal notranslate"><span class="pre">dumps()</span></code></a>:</dt><dd><p>écrit en JSON dans une chaîne de caractères.</p>
</dd>
</dl>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;bar&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;baz&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)}])</span>
<span class="go">&#39;[&quot;foo&quot;, {&quot;bar&quot;: [&quot;baz&quot;, null, 1.0, 2]}]&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="s2">&quot;€&quot;</span><span class="p">)</span>
<span class="go">&#39;&quot;\\u20ac&quot;&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="s1">&#39;[1, 2, &quot;Hello&quot;]&#39;</span><span class="p">)</span>
<span class="go">[1, 2, &#39;Hello&#39;]</span>
</pre></div>
</div>
<p>Un exemple travaillant avec un fichier externe. Un point très important est
que JSON est toujours encodé en UTF-8.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">test.json</span><a class="headerlink" href="#id7" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;counter&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Exemple de lecture et d&#39;écriture depuis et vers un fichier JSON.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="n">entrée</span> <span class="o">=</span> <span class="s2">&quot;test.json&quot;</span>
<span class="n">sortie</span> <span class="o">=</span> <span class="s2">&quot;test.out.json&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">entrée</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">données</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="n">données</span><span class="p">[</span><span class="s2">&quot;counter&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">sortie</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">données</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
<p>Résultat :</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">test.out.json</span><a class="headerlink" href="#id8" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;counter&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="validation">
<h2>Validation<a class="headerlink" href="#validation" title="Lien permanent vers ce titre">¶</a></h2>
<p><a class="reference external" href="https://python-jsonschema.readthedocs.io/en/latest/#module-jsonschema" title="(disponible dans jsonschema v2.3.1.dev211+g5911287)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">jsonschema</span></code></a> permet de valider un document JSON selon un modèle.
Consultez la documentation de <a class="reference external" href="http://json-schema.org/">JSON Schema</a> pour en savoir plus.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">schema.json</span><a class="headerlink" href="#id9" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;counter&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Exemple de validation d&#39;un fichier JSON avec JSON Schema.&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">json</span>

<span class="kn">from</span> <span class="nn">jsonschema</span> <span class="kn">import</span> <span class="n">validate</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;test.json&quot;</span>
<span class="n">schema</span> <span class="o">=</span> <span class="s2">&quot;schema.json&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">sch</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">sch</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> est valide selon </span><span class="si">{</span><span class="n">schema</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="formats-binaires">
<h2>Formats binaires<a class="headerlink" href="#formats-binaires" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un document JSON est un fichier texte, qui consomme plus de place qu’une
représentation binaire. Python offre un format de sérialisation en binaire
nommé <a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a>, comme il est possible d’utiliser des bibliothèques
externes telles que <a class="reference external" href="https://msgpack-python.readthedocs.io/en/latest/api.html#module-msgpack" title="(disponible dans msgpack v1.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">msgpack</span></code></a>, ou <a class="reference external" href="http://thrift.apache.org/">Apache Thrift</a>.</p>
<div class="section" id="pickle">
<h3>Pickle<a class="headerlink" href="#pickle" title="Lien permanent vers ce titre">¶</a></h3>
<p><a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> est le format utilisé par <a class="reference internal" href="../multiprocessing/index.html#multiprocessing-tutorial"><span class="std std-ref">multiprocessing</span></a>
pour échanger des données entre différents processus Python. C’est un format
qui est pratique mais non interopérable avec d’autres langages, voire même
d’autres versions de Python.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">document</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://www.reddit.com/.json&#39;</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="s1">&#39;,:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="go">77266</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pack</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">protocole</span><span class="o">=</span><span class="n">pickle</span><span class="o">.</span><span class="n">HIGHEST_PROTOCOL</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">pack</span><span class="p">)</span>
<span class="go">52227</span>
</pre></div>
</div>
<p>Ce format n’est pas recommandé pour de multiples raisons. La documentation du
module informe que lire du <code class="docutils literal notranslate"><span class="pre">pikle</span></code> revient à faire un <code class="docutils literal notranslate"><span class="pre">eval</span></code>. Ben
Frederickson <a class="bibtex reference internal" href="#fred2014" id="id4">[Fre14]</a> mentionne notamment la lenteur et la taille du
<code class="docutils literal notranslate"><span class="pre">pickle</span></code>.</p>
</div>
<div class="section" id="messagepack">
<h3>MessagePack<a class="headerlink" href="#messagepack" title="Lien permanent vers ce titre">¶</a></h3>
<p>En alternative à <code class="docutils literal notranslate"><span class="pre">pickle</span></code>, <a class="reference external" href="http://msgpack.org/">MessagePack</a> permet de réduire efficacement
l’espace nécessaire au stockage et à l’échange de tels documents. En Python,
c’est le module <a class="reference external" href="https://msgpack-python.readthedocs.io/en/latest/api.html#module-msgpack" title="(disponible dans msgpack v1.0)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">msgpack</span></code></a>.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">document</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://www.reddit.com/.json&#39;</span><span class="p">))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">document</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="s1">&#39;,:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
<span class="go">77244</span>

<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">msgpack</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pack</span> <span class="o">=</span> <span class="n">msgpack</span><span class="o">.</span><span class="n">packb</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">pack</span><span class="p">)</span>
<span class="go">67017</span>
</pre></div>
</div>
<p>Notez que cette petite différence n’est plus forcément intéressante si le
contenu est compressé à l’aide de <a class="reference external" href="https://docs.python.org/3/library/gzip.html#module-gzip" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gzip</span></code></a>.</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">gzip</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">doc</span><span class="p">))</span>
<span class="go">14532</span>

<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">gzip</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">pack</span><span class="p">))</span>
<span class="go">15002</span>
</pre></div>
</div>
<p>Parfois, le mieux est l’ennemi du bien.</p>
</div>
</div>
<div class="section" id="streaming">
<h2>Streaming<a class="headerlink" href="#streaming" title="Lien permanent vers ce titre">¶</a></h2>
<p>Autre inconvénient majeur vis-à-vis du format XML est qu’il n’est pas aisé de
lire un document au fur et à mesure qu’il est reçu, en <em>streaming</em>. En XML, on
utilise une API nommée <abbr title="Simple API for XML">SAX</abbr>. <a class="reference external" href="https://docs.python.org/3/library/json.html#module-json" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">json</span></code></a> propose
un modèle demandant de charger l’entier d’un document en mémoire. Comme avec
DOM en XML. Ce problème se résout à l’aide de <a class="reference external" href="http://lloyd.github.io/yajl/">YAJL</a> et du module <a class="reference external" href="https://pypi.python.org/pypi/ijson/">ijson</a>.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Lecture en streaming d&#39;un gros document JSON.&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span>

<span class="kn">import</span> <span class="nn">ijson</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="s1">&#39;https://www.reddit.com/.json&#39;</span><span class="p">)</span>

<span class="c1"># data.children représente le chemin dans le fichier</span>
<span class="c1"># dont les éléments nous intéressent.</span>
<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">ijson</span><span class="o">.</span><span class="n">items</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;data.children&#39;</span><span class="p">):</span>
    <span class="n">pprint</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Lien permanent vers ce titre">¶</a></h2>
<p>JSON est un format de fichier à connaître, comprendre et savoir utiliser. Dans
sa version basique, voire même dans sa version riche nommée <a class="reference external" href="http://json-ld.org/">JSON-LD</a> utilisée
par de nombreuses API. Si vous devez consommer des données JSON externe, il
n’est que vivement recommandé d’ajouter un schéma afin d’offrir un message
d’erreur adéquat en cas de non respect du document espéré. Et des solutions
existent afin de contourner des problèmes de fichiers inutilement volumineux ou
devant être chargés complètement en mémoire avoir de pouvoir être lus.</p>
<blockquote>
<div><p><em>JSON c’est bon, mangez-en!</em></p>
<p class="attribution">—Anonymous</p>
</div></blockquote>
<dl class="footnote brackets">
<dt class="label" id="yb"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>&lt;<a class="reference external" href="mailto:yoan&#46;blanc&#37;&#52;&#48;he-arc&#46;ch">yoan<span>&#46;</span>blanc<span>&#64;</span>he-arc<span>&#46;</span>ch</a>&gt;</p>
</dd>
</dl>
<p id="bibtex-bibliography-json/index-0"><dl class="citation">
<dt class="bibtex label" id="bray2014javascript"><span class="brackets"><a class="fn-backref" href="#id2">Bra14</a></span></dt>
<dd><p>Tim Bray. The javascript object notation (json) data interchange format. <em>ECMA International®</em>, 2014. URL: <a class="reference external" href="http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf">http://www.ecma-international.org/publications/files/ECMA-ST/ECMA-404.pdf</a>.</p>
</dd>
<dt class="bibtex label" id="fred2014"><span class="brackets"><a class="fn-backref" href="#id4">Fre14</a></span></dt>
<dd><p>Ben Frederickson. Don’t pickle your data. 2014. URL: <a class="reference external" href="http://www.benfrederickson.com/dont-pickle-your-data/">http://www.benfrederickson.com/dont-pickle-your-data/</a>.</p>
</dd>
<dt class="bibtex label" id="schlusser2016"><span class="brackets"><a class="fn-backref" href="#id3">Sch16</a></span></dt>
<dd><p>K.R.T. Schlusser. <em>Hitchhiker’s Guide To Python</em>. O’Reilly Media, Incorporated, 2016. ISBN 9781491933213. URL: <a class="reference external" href="http://docs.python-guide.org/en/latest/">http://docs.python-guide.org/en/latest/</a>.</p>
</dd>
</dl>
</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Bibliothèques Python</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../builtins/index.html">Builtins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../collections/index.html"><code class="docutils literal notranslate"><span class="pre">collections</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../datetime/index.html"><code class="docutils literal notranslate"><span class="pre">datetime</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../dunders/index.html">Dunders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../enum/index.html"><code class="docutils literal notranslate"><span class="pre">enum</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../fstrings/index.html">f-strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../itertools/index.html"><code class="docutils literal notranslate"><span class="pre">itertools</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../io/index.html"><code class="docutils literal notranslate"><span class="pre">io</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../math/index.html"><code class="docutils literal notranslate"><span class="pre">math</span></code> / <code class="docutils literal notranslate"><span class="pre">fractions</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../random/index.html"><code class="docutils literal notranslate"><span class="pre">random</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../time/index.html"><code class="docutils literal notranslate"><span class="pre">time</span></code> / <code class="docutils literal notranslate"><span class="pre">datetime</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../statistics/index.html"><code class="docutils literal notranslate"><span class="pre">statistics</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../super/index.html"><code class="docutils literal notranslate"><span class="pre">super()</span></code></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../abc/index.html">Abstract Base Class (<code class="docutils literal notranslate"><span class="pre">abc</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../binary/index.html"><code class="docutils literal notranslate"><span class="pre">bytes</span></code> / <code class="docutils literal notranslate"><span class="pre">bytearray</span></code> / <code class="docutils literal notranslate"><span class="pre">memoryview</span></code>, <code class="docutils literal notranslate"><span class="pre">struct</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../bisect/index.html"><code class="docutils literal notranslate"><span class="pre">bisect</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../email/index.html">E-mail (<code class="docutils literal notranslate"><span class="pre">smtplib</span></code> / <code class="docutils literal notranslate"><span class="pre">imaplib</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../hashlib/index.html"><code class="docutils literal notranslate"><span class="pre">hashlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../multiprocessing/index.html"><code class="docutils literal notranslate"><span class="pre">multiprocessing</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../re/index.html">Expressions régulières (<code class="docutils literal notranslate"><span class="pre">re</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../secrets/index.html"><code class="docutils literal notranslate"><span class="pre">secrets</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../weakref/index.html"><code class="docutils literal notranslate"><span class="pre">weakref</span></code></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../colorama/index.html"><code class="docutils literal notranslate"><span class="pre">colorama</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../invoke/index.html"><code class="docutils literal notranslate"><span class="pre">invoke</span></code></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../unittest/index.html"><code class="docutils literal notranslate"><span class="pre">unittest</span></code> / <code class="docutils literal notranslate"><span class="pre">doctest</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pytest/index.html"><code class="docutils literal notranslate"><span class="pre">pytest</span></code></a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../csv/index.html"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">json</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pillow/index.html">Python Imaging Library (<code class="docutils literal notranslate"><span class="pre">PIL</span></code>)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../hug/index.html"><code class="docutils literal notranslate"><span class="pre">hug</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../matplotlib/index.html"><code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../networkx/index.html"><code class="docutils literal notranslate"><span class="pre">networkx</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pycrypto/index.html"><code class="docutils literal notranslate"><span class="pre">pycrypto</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../pygame/index.html"><code class="docutils literal notranslate"><span class="pre">pygame</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../sphinx/index.html"><code class="docutils literal notranslate"><span class="pre">sphinx</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../watchdog/index.html"><code class="docutils literal notranslate"><span class="pre">watchdog</span></code></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pbr/index.html"><cite>⚙️Automate your publishing to PyPI with PBR and Travis</cite></a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/about.html">À propos de ce livre</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/contrib.html">Contribution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../licence.html">Creative Commons Attribution-ShareAlike 4.0 International</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../csv/index.html" title="Chapitre précédent"><code class="docutils literal notranslate"><span class="pre">csv</span></code></a></li>
      <li>Next: <a href="../pillow/index.html" title="Chapitre suivant">Python Imaging Library (<code class="docutils literal notranslate"><span class="pre">PIL</span></code>)</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016-2017, HE-Arc.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/json/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>